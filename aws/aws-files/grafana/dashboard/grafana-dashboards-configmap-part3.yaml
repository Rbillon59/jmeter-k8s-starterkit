apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-kubernetes-input
data:
  telegraf-kubernetes-input-dashboard.json: |-
    {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"description":"Kubernetes Aggregated Container Stats by Namespace and Container","editable":true,"gnetId":9111,"graphTooltip":0,"iteration":1620649481645,"links":[],"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"default","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":8,"x":0,"y":0},"id":12,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_node","orderByTime":"ASC","policy":"default","query":"SELECT count(distinct(node_name)) FROM (SELECT mean(\"cpu_usage_core_nanoseconds\") AS \"mean_cpu_usage_core_nanoseconds\" FROM \"kubernetes_pod_container\" WHERE time > now() - 1m GROUP BY time(1h), \"node_name\" LIMIT 1) FILL(previous)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["cpu_usage_core_nanoseconds"],"type":"field"}]],"tags":[]}],"thresholds":"","title":"Total Nodes","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"default","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":8,"x":8,"y":0},"id":13,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_node","orderByTime":"ASC","policy":"default","query":"SELECT count(pod_name) FROM (SELECT mean(\"cpu_usage_core_nanoseconds\") AS \"mean_cpu_usage_core_nanoseconds\" FROM \"kubernetes_pod_container\" WHERE time > now() - 1m AND namespace =~ /^$ns$/ AND container_name =~ /^$name$/ GROUP BY time(1h), \"pod_name\" LIMIT 1) FILL(previous)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["cpu_usage_core_nanoseconds"],"type":"field"}]],"tags":[]}],"thresholds":"","title":"Total Pods","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"default","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":8,"x":16,"y":0},"id":14,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_node","orderByTime":"ASC","policy":"default","query":"SELECT count(container_name) FROM (SELECT mean(\"cpu_usage_core_nanoseconds\") AS \"mean_cpu_usage_core_nanoseconds\" FROM \"kubernetes_pod_container\" WHERE time > now() - 1m AND namespace =~ /^$ns$/ AND container_name =~ /^$name$/ GROUP BY time(1h), \"container_name\",\"pod_name\" LIMIT 1) FILL(previous)\n","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["cpu_usage_core_nanoseconds"],"type":"field"}]],"tags":[]}],"thresholds":"","title":"Total Containers","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":3},"id":7,"panels":[],"repeat":null,"title":"CPU","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"default","description":"","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":4},"height":"","hiddenSeries":false,"id":2,"interval":">60s","legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.3","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Millicores - $tag_container_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["container_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"hide":false,"measurement":"kubernetes_pod_container","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"cpu/usage_rate\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"A","resultFormat":"time_series","select":[[{"params":["cpu_usage_nanocores"],"type":"field"},{"params":[],"type":"mean"},{"params":[" / 1000"],"type":"math"}]],"tags":[{"key":"namespace","operator":"=~","value":"/^$ns$/"},{"condition":"AND","key":"container_name","operator":"=~","value":"/^$name$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"CPU - Milicores","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":12},"id":8,"panels":[],"repeat":null,"title":"Memory","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"default","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":13},"height":"","hiddenSeries":false,"id":3,"interval":">60s","legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.3","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Usage - $tag_container_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["container_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_pod_container","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"memory/usage\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"A","resultFormat":"time_series","select":[[{"params":["memory_usage_bytes"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"pod_name","operator":"=~","value":"/^$name/"},{"condition":"AND","key":"namespace","operator":"=~","value":"/^$ns$/"}]},{"alias":"RSS - $tag_container_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["container_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_pod_container","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"memory/usage\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"B","resultFormat":"time_series","select":[[{"params":["memory_rss_bytes"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"pod_name","operator":"=~","value":"/^$name/"},{"condition":"AND","key":"namespace","operator":"=~","value":"/^$ns$/"}]},{"alias":"Page Faults - $tag_container_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["container_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_pod_container","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"memory/usage\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"C","resultFormat":"time_series","select":[[{"params":["memory_page_faults"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"pod_name","operator":"=~","value":"/^$name/"},{"condition":"AND","key":"namespace","operator":"=~","value":"/^$ns$/"}]},{"alias":"Major Page Faults - $tag_container_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["container_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_pod_container","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"memory/usage\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"D","resultFormat":"time_series","select":[[{"params":["memory_major_page_faults"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"pod_name","operator":"=~","value":"/^$name/"},{"condition":"AND","key":"namespace","operator":"=~","value":"/^$ns$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":21},"id":9,"panels":[],"repeat":null,"title":"Network","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"default","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":22},"height":"","hiddenSeries":false,"id":5,"interval":">60s","legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.3","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"RX - $tag_pod_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["pod_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_pod_network","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"network/rx_rate\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"A","resultFormat":"time_series","select":[[{"params":["rx_bytes"],"type":"field"},{"params":[],"type":"mean"},{"params":["10s"],"type":"derivative"}]],"tags":[{"key":"namespace","operator":"=~","value":"/^$ns$/"},{"condition":"AND","key":"pod_name","operator":"=~","value":"/^$name.*/"}]},{"alias":"TX - $tag_pod_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["pod_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_pod_network","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"network/tx_rate\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"B","resultFormat":"time_series","select":[[{"params":["tx_bytes"],"type":"field"},{"params":[],"type":"mean"},{"params":["10s"],"type":"derivative"}]],"tags":[{"key":"pod_name","operator":"=~","value":"/^$name/"},{"condition":"AND","key":"namespace","operator":"=~","value":"/^$ns$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Network","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":29},"id":10,"panels":[],"repeat":null,"title":"Filesystem","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"default","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":6,"w":24,"x":0,"y":30},"height":"","hiddenSeries":false,"id":6,"interval":">60s","legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.3","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Used - $tag_volume_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["volume_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_pod_volume","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"memory/usage\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"A","resultFormat":"time_series","select":[[{"params":["used_bytes"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"pod_name","operator":"=~","value":"/^$name/"},{"condition":"AND","key":"namespace","operator":"=~","value":"/^$ns$/"}]},{"alias":"Available - $tag_volume_name","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["volume_name"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"kubernetes_pod_volume","orderByTime":"ASC","policy":"default","query":"SELECT mean(\"value\") FROM \"memory/usage\" WHERE \"type\" = 'pod' AND \"labels\" =~ /k8s-app:fluentd-logging,/ AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":false,"refId":"B","resultFormat":"time_series","select":[[{"params":["available_bytes"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"pod_name","operator":"=~","value":"/^$name/"},{"condition":"AND","key":"namespace","operator":"=~","value":"/^$ns$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Filesystem","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"5s","schemaVersion":26,"style":"dark","tags":["kubernetes","influxdb","Container","Telegraf"],"templating":{"list":[{"allValue":null,"current":{"selected":false,"text":"All","value":"$__all"},"datasource":"default","definition":"","error":null,"hide":0,"includeAll":true,"label":"Namespace","multi":false,"name":"ns","options":[],"query":"SHOW TAG VALUES FROM \"kubernetes_pod_container\" WITH KEY=namespace","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":"All","value":"$__all"},"datasource":"default","definition":"","error":null,"hide":0,"includeAll":true,"label":"Container Name","multi":false,"name":"name","options":[],"query":"SHOW TAG VALUES FROM \"kubernetes_pod_container\" WITH KEY=container_name WHERE \"namespace\" =~ /^$ns$/","refresh":2,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"Kubernetes Aggregated Container Stats","uid":"SqmE2QBiz","version":1}